{% extends "layout.html" %}

{% block main %}

<form id="form" action='/form' method='post' autocomplete="off">
    <div class="form-group">
        <label for="year">Select a year</label>
        <select class="form-control required" id="year" name="year" onchange="question(this.value);">
          <option selected disabled>--Years 2016-2019 supported--</option>
          <option value="2016">2016</option>
          <option value="2017">2017</option>
          <option value="2018">2018</option>
          <option value="2019">2019</option>
        </select>
    </div>
    <div id="questionsDiv" class="form-group">
        <!-- Questions form goes here via AJAX-->
    </div>
    <div id="answerDiv" class="form-group" style="display: none;">
        <label for="answer">Enter your answer</label>
        <input type="text" class="form-control required" id="answer" name="answer">
    </div>
    <button class="btn btn-primary" type="submit" id="submit" style="display: none;">Check solution</button>
</form>
<br>
{% if request.method == "POST" %}
<table class="table table-striped table-hover">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Year</th>
        <th scope="col">Question</th>
        <th scope="col">Complete?</th>
      </tr>
    </thead>
    <tbody>
      <th scope=row></th>
      <td></td>
      <td></td>
    </tbody>
  </table>
{% endif %}

<script>
subbut = document.querySelector('#submit');
// This function receives the year input by the user and reveals the form category for 
// question choice, answer input and submit button.
function question(year)
{
    // Deal with situation where nothing is chosen
    if (year == "")
        return;
    // create AJAX object
    var ajax = new XMLHttpRequest();
    // callback function to pre-fill div once page is loaded
    ajax.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            document.getElementById("questionsDiv").innerHTML = this.responseText;
        }
    }
    // Open file and transmit data
    ajax.open("GET", year, true);
    ajax.send();

    // Also reveal answer and submit button
    answerDiv = document.getElementById("answerDiv");
    answerDiv.style.display = "block";
    submit.style.display = "block";
}


// Implement client-side form validation with javaScript
subbut.onclick = function() {
    let chooseYear = document.querySelector('#year');
    let chooseQuestion = document.querySelector('#choosequestion');
    let chooseAnswer = document.querySelector('#answer');
    let form = document.querySelector('form');
    if (!chooseYear.value) {
        alert ('You must provide a year!');
        return false;
    }
    else if (chooseQuestion.value == "") {
        alert ('You must provide a question!');
        return false;
    }
    else if (!chooseAnswer.value) {
        alert ('You must provide an answer!');
        return false;
    }
    return true;
};

</script>

{% endblock main %}